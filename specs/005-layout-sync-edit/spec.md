# Feature Specification: 웹/PDF 레이아웃 동기화 및 텍스트 편집 기능

**Feature Branch**: `005-layout-sync-edit`
**Created**: 2025-12-23
**Status**: Draft
**Input**: User description: "웹 레이아웃과 pdf 레이아웃 동기화 + 해설 부분에 어휘 답 표시 + 모든 텍스트 편집 기능 추가"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 웹 미리보기와 PDF 출력 일치 (Priority: P1)

사용자가 웹 화면에서 보는 레이아웃이 PDF로 다운로드했을 때와 동일하게 출력된다. 현재 웹 미리보기와 실제 PDF 출력 사이에 레이아웃 차이가 있어 사용자가 최종 결과물을 예측하기 어려운 문제를 해결한다.

**Why this priority**: WYSIWYG(What You See Is What You Get) 경험은 교재 제작 도구의 핵심 가치이다. 사용자가 웹에서 편집한 내용이 PDF에서 다르게 보이면 반복 수정 작업이 필요해 생산성이 크게 저하된다.

**Independent Test**: 웹 미리보기 화면을 스크린샷으로 캡처하고, PDF를 다운로드하여 동일 페이지와 비교했을 때 레이아웃(여백, 줄바꿈, 폰트 크기, 요소 배치)이 일치하면 성공

**Acceptance Scenarios**:

1. **Given** 문제집 데이터가 입력된 상태, **When** 웹 미리보기에서 문제지를 확인한 후 PDF를 다운로드하면, **Then** PDF의 문제 배치, 여백, 페이지 나눔이 웹 미리보기와 동일하다
2. **Given** 해설지가 생성된 상태, **When** 웹에서 해설지를 확인한 후 PDF를 다운로드하면, **Then** 해설 내용의 레이아웃과 줄바꿈 위치가 웹과 PDF에서 동일하다
3. **Given** 단어장 데이터가 입력된 상태, **When** 카드형/표형 뷰를 PDF로 저장하면, **Then** 각 단어 카드/행의 배치가 웹 미리보기와 일치한다

---

### User Story 2 - 해설지에 어휘 문제 정답 표시 (Priority: P2)

사용자가 해설지를 확인할 때, 어휘(동의어) 유형 문제의 정답이 명확하게 표시되어 학생들이 쉽게 확인할 수 있다.

**Why this priority**: 어휘 문제는 편입/수능 영어에서 중요한 비중을 차지하며, 정답을 빠르게 확인할 수 있어야 학습 효율이 높아진다.

**Independent Test**: 어휘 유형 문제의 해설지를 열었을 때 정답 번호와 해당 보기가 시각적으로 강조되어 있으면 성공

**Acceptance Scenarios**:

1. **Given** 어휘(동의어) 유형 문제가 포함된 해설지, **When** 해설지를 확인하면, **Then** 정답 번호(①②③④⑤)가 명확하게 표시되고 정답 보기가 강조 표시된다
2. **Given** 해설지 PDF를 다운로드한 상태, **When** 어휘 문제 해설을 확인하면, **Then** 웹에서 보이는 것과 동일하게 정답이 강조되어 있다
3. **Given** 여러 유형의 문제가 섞인 해설지, **When** 어휘 유형 문제를 찾으면, **Then** 해당 문제만 정답 표시 형식이 적용되고 다른 유형은 기존 형식을 유지한다

---

### User Story 3 - 모든 텍스트 인라인 편집 (Priority: P3)

사용자가 웹 미리보기 화면에서 직접 텍스트를 클릭하여 수정할 수 있다. AI가 생성한 해설, 번역, 단어 뜻 등 모든 텍스트 요소를 별도 입력창 없이 현재 위치에서 바로 편집할 수 있다.

**Why this priority**: 현재는 일부 요소만 편집 가능하거나 사이드바에서 수정해야 한다. WYSIWYG 편집으로 사용자 경험을 개선하면 작업 속도가 크게 향상된다.

**Independent Test**: 웹 미리보기에서 임의의 텍스트(지문 번역, 해설, 단어 뜻 등)를 클릭하여 직접 수정하고, 수정 내용이 즉시 반영되며 PDF에도 적용되면 성공

**Acceptance Scenarios**:

1. **Given** 해설지가 표시된 상태, **When** 지문 번역 텍스트를 클릭하면, **Then** 해당 위치에서 텍스트를 직접 편집할 수 있는 입력 상태가 된다
2. **Given** 해설지가 표시된 상태, **When** AI 생성 해설 텍스트를 클릭하여 수정하면, **Then** 수정된 내용이 즉시 화면에 반영되고 PDF 다운로드 시에도 수정된 내용이 출력된다
3. **Given** 단어장이 표시된 상태, **When** 단어 뜻, 예문, 번역 등을 클릭하여 편집하면, **Then** 해당 텍스트가 수정되고 저장된다
4. **Given** 편집 중인 상태, **When** 다른 영역을 클릭하거나 Enter/Escape 키를 누르면, **Then** 편집이 완료되고 변경 사항이 저장된다

---

### Edge Cases

- 웹 화면 크기와 A4 PDF 크기 비율이 다를 때: PDF 이미지를 스케일링하여 표시하므로 비율 차이 문제 없음
- 긴 텍스트 편집 시 페이지 경계를 넘어가면: PDF 재렌더링하여 자동 페이지 분할 적용
- 사용자가 편집 중 브라우저를 새로고침하면: 편집 완료된 것만 저장되고, 편집 중인 내용은 유실됨
- 빈 텍스트로 수정하려고 할 때: 빈 값 허용 안함, 원본 텍스트로 복원됨
- 특수문자나 마크업 문법이 포함된 텍스트 편집 시 올바르게 렌더링되는가?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템 MUST PDF 렌더링 결과를 이미지로 변환하여 웹 미리보기에 표시한다 (완벽한 레이아웃 일치 보장)
- **FR-002**: 시스템 MUST 웹 미리보기에서 A4 용지 비율을 정확하게 시뮬레이션한다
- **FR-003**: 시스템 MUST 페이지 경계와 자동 페이지 분할을 웹과 PDF에서 동일하게 처리한다
- **FR-004**: 시스템 MUST 어휘(동의어) 유형 문제의 해설지에 정답 번호와 정답 보기를 명확하게 표시한다
- **FR-005**: 시스템 MUST 정답 표시를 볼드 + 색상 강조(기존 팔레트 사용)로 시각적으로 강조한다
- **FR-006**: 사용자 MUST be able to PDF 이미지 위 오버레이 편집 영역을 통해 모든 텍스트 요소를 클릭하여 인라인 편집할 수 있다
- **FR-007**: 시스템 MUST 편집된 텍스트를 실시간으로 화면에 반영한다 (PDF 재렌더링)
- **FR-008**: 시스템 MUST 편집된 내용을 PDF 다운로드 시 정확하게 출력한다
- **FR-009**: 시스템 MUST 편집 가능한 요소에 시각적 힌트(호버 시 편집 아이콘 또는 테두리)를 제공한다
- **FR-010**: 시스템 MUST 편집 완료 시(포커스 아웃, Enter, Escape) 변경 사항을 저장한다
- **FR-011**: 시스템 MUST 빈 텍스트 입력 시 원본 텍스트로 복원한다

### Key Entities

- **PDF 이미지 프리뷰**: @react-pdf/renderer로 생성된 PDF를 이미지(PNG/canvas)로 변환하여 웹에 표시
- **편집 오버레이**: PDF 이미지 위에 위치하는 투명 레이어로, 각 편집 가능 텍스트 영역의 좌표를 매핑
- **편집 가능 텍스트**: 인라인 편집이 가능한 텍스트 요소 (지문 번역, 해설, 단어 뜻, 예문 등)
- **정답 표시 스타일**: 어휘 문제 정답의 볼드 + 색상 강조 (colorPalette 사용)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 웹 미리보기와 PDF 출력의 레이아웃 일치율 95% 이상 (동일 페이지 수, 동일 줄바꿈 위치)
- **SC-002**: 사용자가 PDF 다운로드 전 레이아웃 예측 정확도 향상 - 반복 수정 횟수 50% 감소
- **SC-003**: 어휘 문제 정답 확인 시간 2초 이내 (기존 해설 텍스트 읽기 대비)
- **SC-004**: 모든 텍스트 요소의 90% 이상이 인라인 편집 가능
- **SC-005**: 텍스트 편집 후 저장까지 1초 이내 반응
- **SC-006**: 편집된 내용이 PDF에 100% 정확하게 반영됨

## Assumptions

- 웹 미리보기는 A4 용지 비율(210mm x 297mm)을 기준으로 렌더링한다
- 편집된 내용은 현재 세션에 저장되며, localStorage 세션 저장 기능과 연동된다
- 인라인 편집은 마우스 클릭 또는 탭 키로 활성화할 수 있다
- 정답 표시 스타일은 기존 앱의 색상 팔레트를 따른다
- 특수 마크업(_word_, __________ 등)은 편집 시에도 올바르게 처리된다

## Clarifications

### Session 2025-12-23

- Q: 사용자가 편집 중 브라우저를 새로고침하면 변경 사항이 유지되는가? → A: 편집 완료된 것만 저장 (편집 중인 건 유실)
- Q: 웹과 PDF 레이아웃 동기화 구현 접근 방식? → A: PDF 렌더링 결과를 웹에 이미지로 표시
- Q: 어휘 문제 정답 표시의 시각적 강조 방식? → A: 볼드 + 색상 강조 (기존 팔레트 사용)
- Q: PDF를 이미지로 표시할 때 편집 기능 제공 방식? → A: PDF 이미지 위 오버레이 편집 영역
- Q: 빈 텍스트로 수정하려고 할 때 처리 방식? → A: 빈 값 허용 안함 (원본으로 복원)
