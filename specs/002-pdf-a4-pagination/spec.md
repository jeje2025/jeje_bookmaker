# Feature Specification: PDF A4 페이지 분할

**Feature Branch**: `002-pdf-a4-pagination`
**Created**: 2025-12-23
**Status**: Draft
**Input**: User description: "pdf 다운로드 - a4 크기로 페이지 잘라서 나오도록"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - PDF A4 페이지 경계에서 자동 분할 (Priority: P1)

사용자가 문제지, 해설지, 단어장 등의 콘텐츠를 PDF로 다운로드할 때, 시스템은 콘텐츠를 A4 페이지 크기에 맞게 자동으로 분할하여 텍스트나 요소가 페이지 경계에서 잘리지 않도록 한다.

**Why this priority**: PDF 출력물의 가독성과 인쇄 품질에 직접적인 영향을 미치는 핵심 기능이다. 페이지 경계에서 콘텐츠가 잘리면 인쇄 시 정보 손실이 발생한다.

**Independent Test**: 30문제 이상의 문제지/해설지를 PDF로 다운로드하여 모든 페이지에서 텍스트와 요소가 잘리지 않고 완전하게 표시되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 사용자가 문제지를 PDF로 다운로드할 때, **When** 콘텐츠가 한 페이지에 들어가지 않으면, **Then** 시스템은 문제 단위로 페이지를 분할하여 문제 중간에 페이지가 나뉘지 않아야 한다.
2. **Given** 사용자가 해설지를 PDF로 다운로드할 때, **When** 해설 블록이 페이지 끝에 위치하면, **Then** 시스템은 해설 블록 전체를 다음 페이지로 이동시켜야 한다.
3. **Given** 단어장 카드형 뷰를 PDF로 다운로드할 때, **When** 단어 카드가 페이지 경계에 걸치면, **Then** 해당 카드 전체가 다음 페이지에 표시되어야 한다.

---

### User Story 2 - 긴 지문의 페이지 분할 처리 (Priority: P2)

단일 지문이나 해설이 A4 한 페이지를 초과하는 경우, 시스템은 문단 또는 문장 단위로 자연스럽게 분할하여 가독성을 유지한다.

**Why this priority**: 긴 영어 지문이나 상세한 해설의 경우 한 페이지를 초과할 수 있으며, 이 경우 적절한 분할이 필요하다.

**Independent Test**: 500단어 이상의 긴 지문을 포함한 문제를 PDF로 다운로드하여 페이지 분할이 문장 중간이 아닌 자연스러운 위치에서 이루어지는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 한 페이지를 초과하는 긴 지문이 있을 때, **When** PDF를 생성하면, **Then** 지문은 문단 또는 문장 경계에서 분할되어야 한다.
2. **Given** 페이지가 분할된 경우, **When** 사용자가 PDF를 확인하면, **Then** 분할된 페이지 상단에 "(계속)" 또는 연속 표시가 있어야 한다.

---

### User Story 3 - 페이지 번호 및 여백 일관성 (Priority: P3)

모든 PDF 페이지에 일관된 여백과 페이지 번호가 표시되어 인쇄 시 전문적인 품질을 유지한다.

**Why this priority**: 인쇄물의 전문성과 사용성을 높이는 부가 기능으로, 핵심 분할 기능 이후에 구현한다.

**Independent Test**: 10페이지 이상의 PDF를 다운로드하여 모든 페이지의 여백과 페이지 번호가 동일한 위치에 일관되게 표시되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 여러 페이지로 구성된 PDF가 생성될 때, **When** 사용자가 PDF를 확인하면, **Then** 모든 페이지 하단에 "페이지 N / 전체" 형식의 페이지 번호가 표시되어야 한다.
2. **Given** PDF가 생성될 때, **When** 인쇄를 실행하면, **Then** 상하좌우 여백이 인쇄 가능 영역 내에 위치하여 콘텐츠 손실이 없어야 한다.

---

### Edge Cases

- **단일 블록 페이지 초과**: 콘텐츠 블록이 현재 페이지 남은 공간에 들어가지 않으면 블록 전체를 다음 페이지로 이동한다.
- **이미지/표 분할**: 이미지나 표가 포함된 콘텐츠는 해당 요소 전체를 다음 페이지로 이동하여 분할을 방지한다.
- **빈 페이지 방지**: 콘텐츠 블록 이동 후 이전 페이지에 충분한 공간이 남으면 다음 블록으로 채운다.
- **문제 그룹 분리**: 같은 지문을 공유하는 문제 그룹(예: 문제 A, B)이 페이지 경계에서 잘릴 경우, 그룹을 해제하고 첫 번째 문제(A)를 현재 페이지에 배치한다. 두 번째 문제(B)는 다음 페이지로 이동하며, 같은 지문을 공유하는 후속 문제(C)가 있으면 B와 C를 새로운 그룹으로 형성한다.

## Clarifications

### Session 2025-12-23

- Q: 단일 콘텐츠 블록이 A4 한 페이지를 초과할 때 어떻게 처리할 것인가? → A: 문제를 다음 페이지로 이동 (블록 전체를 다음 페이지에 배치)
- Q: 문제 그룹이 페이지 경계에서 잘릴 때 어떻게 처리할 것인가? → A: 그룹 해제 후 첫 문제는 현재 페이지에, 나머지는 다음 페이지로 이동. 같은 지문 공유하는 후속 문제가 있으면 새 그룹 형성

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 PDF 생성 시 A4 용지 크기(210mm × 297mm)를 기준으로 콘텐츠를 페이지별로 분할해야 한다.
- **FR-002**: 시스템은 문제, 해설, 단어 카드 등의 논리적 단위가 페이지 경계에서 분리되지 않도록 해야 한다.
- **FR-003**: 시스템은 논리적 단위가 한 페이지에 들어가지 않을 경우, 해당 단위를 다음 페이지로 이동시켜야 한다.
- **FR-004**: 시스템은 한 페이지를 초과하는 긴 콘텐츠의 경우 문장 또는 문단 단위로 자연스럽게 분할해야 한다.
- **FR-005**: 시스템은 모든 페이지에 일관된 상하좌우 여백(최소 15mm)을 적용해야 한다.
- **FR-006**: 시스템은 각 페이지 하단에 페이지 번호를 표시해야 한다.
- **FR-007**: 시스템은 분할된 콘텐츠의 연속성을 표시하는 시각적 단서를 제공해야 한다.

### Key Entities

- **Page**: A4 크기의 출력 단위, 여백 및 콘텐츠 영역 포함
- **ContentBlock**: 분할 불가능한 논리적 콘텐츠 단위 (문제, 해설, 카드 등)
- **PageBreak**: 페이지 분할 지점, 콘텐츠 블록 경계에서만 발생

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: PDF 생성 후 모든 페이지에서 텍스트나 요소가 페이지 경계에서 잘리는 현상이 0건이어야 한다.
- **SC-002**: 30문제 기준 PDF 생성 시간이 15초 이내여야 한다.
- **SC-003**: 생성된 PDF를 실제 A4 용지에 인쇄했을 때 콘텐츠 손실 없이 출력되어야 한다.
- **SC-004**: 100페이지 이상의 대용량 PDF도 안정적으로 생성되어야 한다.

## Assumptions

- 현재 시스템은 이미 PDF 생성 기능을 보유하고 있다.
- A4PageLayout 컴포넌트가 이미 존재하며, 페이지 분할 로직의 기반으로 활용할 수 있다.
- 모든 콘텐츠는 세로 방향(Portrait) A4로 출력된다.
- 인쇄 시 여백 설정은 사용자의 프린터 설정에 따라 달라질 수 있으나, 시스템은 안전한 기본 여백을 적용한다.

## Out of Scope

- 가로 방향(Landscape) PDF 생성
- 사용자 정의 용지 크기 지원
- PDF 암호 보호 기능
- PDF 내 하이퍼링크 기능
